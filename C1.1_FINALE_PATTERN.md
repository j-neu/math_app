# C1.1 Finale Level Pattern Documentation

**Exercise:** C1.1 - Count the Dots V2
**Finale Level:** Level 5 - Mixed Review
**Date Created:** 2025-11-04
**Purpose:** Reference pattern for implementing finale levels in other exercises

---

## Core Principle: True Mixed Review

The finale level is a **true mixed review** that cycles through interaction types from ALL previous card-prescribed levels, not just a single easier version.

### Why Mixed Review?

1. **Variety prevents boredom** - ADHD children benefit from changing activities
2. **Demonstrates versatility** - Shows mastery across multiple methods
3. **Easyâ†’Hardâ†’Easy flow** - Ends exercise on positive note with manageable challenge
4. **Authentic assessment** - Tests understanding, not just repetition

---

## C1.1 Implementation: 3 Cycling Interaction Types

### Type 1: Drag & Drop (from Level 1)
- **Action:** Child drags each dot to a "Counted" area
- **Visual:** Split screen - dots area (top) and drop target area (bottom)
- **Feedback:** Live counter shows "Counted: X" as dots are dragged
- **Submit:** "Done Dragging" button

### Type 2: Tap/Click (from Level 2)
- **Action:** Child taps each dot to mark it as counted
- **Visual:** Dots change color (blue â†’ green) and show checkmark when tapped
- **Feedback:** Visual state change provides immediate feedback
- **Submit:** "Done Tapping" button

### Type 3: Just Count (from Level 3)
- **Action:** Child counts silently by looking, enters total
- **Visual:** Static structured grid of dots (no interaction)
- **Feedback:** Text input field for entering count
- **Submit:** "Submit" button with number entry

### Cycling Logic

```dart
// Cycles through types based on problem number
_currentInteractionType = InteractionType.values[_totalAttempts % 3];
// Problem 0: drag, 1: tap, 2: count, 3: drag, 4: tap...
```

---

## Difficulty Parameters (Easier than Max)

| Parameter | Card Max (Level 4) | Finale (Level 5) |
|-----------|-------------------|------------------|
| **Dot Count** | 5-20 (adaptive to 20) | 8-12 (fixed easier range) |
| **Layout** | Structured or Random | Structured only |
| **Flash/Hide** | Yes (2s then hide) | No (always visible) |
| **Interaction** | Eyes only | Mixed (drag/tap/count) |

**Rationale:** The finale is easier than the hardest level (4) to provide a "victory lap" experience.

---

## Completion Criteria

- **Minimum Problems:** 10 (ensures at least 3 cycles through all types)
- **Accuracy Required:** Zero errors (100%)
- **Time Limit:** <20s per problem
- **Status Change:** `finished` â†’ `completed` when criteria met

---

## Code Structure

### Key Components

```dart
enum InteractionType {
  drag,   // Level 1 method
  tap,    // Level 2 method
  count,  // Level 3 method
}

class DotState {
  final Offset position;
  bool isCounted;
}
```

### State Management

```dart
int _currentDotCount = 8;
InteractionType _currentInteractionType = InteractionType.drag;
List<DotState> _dots = [];
int _dotsCountedInArea = 0;  // For drag interaction

int _correctAnswers = 0;
int _totalAttempts = 0;
```

### Answer Validation

```dart
void _checkAnswer() {
  int userAnswer;

  if (_currentInteractionType == InteractionType.count) {
    // Count-only: get answer from text field
    userAnswer = int.tryParse(_controller.text.trim()) ?? 0;
  } else {
    // Drag/tap: count marked dots
    userAnswer = _dots.where((dot) => dot.isCounted).length;
  }

  final isCorrect = userAnswer == _currentDotCount;
  // ...
}
```

---

## UI Layout Pattern

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Header (Green) - "Level 5: Finale"     â”‚
â”‚ Dynamic instruction based on type       â”‚
â”‚ Progress: Correct / Total / Accuracy   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                         â”‚
â”‚   [Dynamic Interaction Area]            â”‚
â”‚   - Drag: Dots + Drop Target           â”‚
â”‚   - Tap: Tappable Dots Grid             â”‚
â”‚   - Count: Static Dots + Input Field    â”‚
â”‚                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Feedback Box (if shown)                 â”‚
â”‚ "Correct! ğŸ‰" or "Oops! Try again"     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [Dynamic Submit Button]                 â”‚
â”‚ Text changes: "Done Dragging" /        â”‚
â”‚ "Done Tapping" / "Submit"               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Adapting This Pattern to Other Exercises

### Step 1: Identify Card-Prescribed Levels

Review the iMINT/PIKAS card's "Wie kommt die Handlung in den Kopf?" section to identify:
- How many levels the card prescribes (2, 3, 4, or more)
- What specific interactions each level uses

### Step 2: Extract Interaction Types

For each card-prescribed level, determine the core interaction:
- **Level 1:** What action? (drag, tap, draw, arrange, bundle, etc.)
- **Level 2:** What action? (often with visual support)
- **Level 3:** What action? (often reduced support)
- **Level 4:** What action? (if applicable)

### Step 3: Design Finale Mixing Strategy

Choose 2-4 representative interaction types from the card levels:
- Skip duplicates (e.g., if Level 2 & 3 both use tapping, pick one)
- Prioritize diversity (different modalities: motor, visual, mental)
- Ensure all types are at "easier" difficulty than hardest card level

### Step 4: Implement Cycling Logic

```dart
// For 3 types:
_currentType = TypeEnum.values[_totalAttempts % 3];

// For 2 types:
_currentType = (_totalAttempts % 2 == 0) ? TypeEnum.first : TypeEnum.second;

// For 4 types:
_currentType = TypeEnum.values[_totalAttempts % 4];
```

### Step 5: Unified Answer Checking

Create a single `_checkAnswer()` method that handles all interaction types:

```dart
void _checkAnswer() {
  int userAnswer;

  // Get answer based on current interaction type
  switch (_currentInteractionType) {
    case TypeEnum.typeA:
      userAnswer = /* extract from TypeA state */;
      break;
    case TypeEnum.typeB:
      userAnswer = /* extract from TypeB state */;
      break;
    // ...
  }

  final isCorrect = userAnswer == _expectedAnswer;
  // Handle feedback and progress...
}
```

---

## Examples for Other Exercises

### Z1: Decompose 10

**Card Levels:**
1. Level 1: Tap counters to flip (explore decompositions)
2. Level 2: See decomposition, write equation
3. Level 3: Find all 11 decompositions from memory

**Finale Interaction Types:**
- **Type A:** Tap to decompose (from L1)
- **Type B:** See and write (from L2)
- **Type C:** Write from prompt (easier than L3 - single decomposition, not all 11)

**Difficulty:** Decompose 5-8 (easier than 10)

### C3.1: Count Forward

**Card Levels:**
1. Level 1: Hop on number line (interactive movement)
2. Level 2: See position, write next numbers
3. Level 3: Count forward from memory (no line)

**Finale Interaction Types:**
- **Type A:** Hop to demonstrate (from L1, shorter sequence)
- **Type B:** Fill in blanks (from L2, 3-5 numbers)
- **Type C:** Write sequence (from L3, easier range 0-15 not 0-20)

**Difficulty:** 3-5 number sequences (vs 5-7 in harder levels)

### C4.1: What Comes Next?

**Card Levels:**
1. Level 1: Explore predecessor/successor on line
2. Level 2: Write neighbors (both before and after)
3. Level 3: Mixed challenges (before, after, or both)

**Finale Interaction Types:**
- **Type A:** Tap neighbors on number line (from L1)
- **Type B:** Write both neighbors (from L2)
- **Type C:** Single neighbor (before OR after, not both)

**Difficulty:** Range 5-15 (vs 0-20 in harder levels)

---

## Testing Checklist

When implementing a finale level with mixed interactions:

- [ ] All interaction types work correctly
- [ ] Cycling logic alternates types properly
- [ ] Answer validation works for all types
- [ ] Instructions update to match current type
- [ ] Button text updates to match current type
- [ ] Difficulty is easier than hardest card level
- [ ] 10+ problems ensure multiple cycles through all types
- [ ] Progress tracking works across type changes
- [ ] Feedback is clear and immediate
- [ ] Auto-advance after correct answer works
- [ ] Exercise can be completed (meets "completed" criteria)

---

## Key Takeaways

1. **Finale â‰  Single Easier Level** - It's a mixed review of ALL previous methods
2. **Cycle, Don't Random** - Predictable cycling ensures balanced practice
3. **Easier Difficulty** - Use mid-range parameters, avoid max difficulty
4. **Unified Validation** - One `_checkAnswer()` handles all interaction types
5. **Clear Instructions** - UI updates dynamically to guide each interaction type
6. **Victory Lap Mentality** - Child should feel successful, not challenged

---

**File:** [countdots_level5_widget_v2.dart](math_app/lib/widgets/countdots_level5_widget_v2.dart)
**Lines:** ~608 lines
**Pattern Status:** âœ… Reference implementation complete
